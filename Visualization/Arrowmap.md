---
sort: 4
---

# Arrow Map

Although the [Field Map](https://pjjung.github.io/mcgpy/Visualization/Fieldmap.html) is a scalar dataset, current dipole distribution can be obtained by calculating the gradient on each cell. For this purpose, the `FieldMap` object provides the information of current arrows and a field pole arrow via `arrows()` and `pole()` methods.

Since their information is stored as `astropy.table` table, several steps are required to polt the Arrow Map. Following example is based on a randomly created dataset by `numpy` and used `matplotlib`.

## Get Field Map

```python
>>> from mcgpy.timeseries import TimeSeriesArray
>>> from mcgpy.numeric import FieldMap
>>> import numpy as np
>>> source = np.random.random((64,1024))
>>> positions = [(x,y,0) for x in np.linspace(-240,240,8) for y in np.linspace(-240,240,8)]
>>> directions = np.vander(np.linspace(0,0,64),3)
>>> dataset = TimeSeriesArray(source=source, positions=positions, directions=directions, t0=0, sample_rate=1024)
>>> epoch_dataset = dataset.at(0)
>>> Bz = FieldMap(epoch_dataset)
```

## Get the information of current and the pole arrows

```python
>>> arrows_info = Bz.arrows()
>>> print(arrows_info)
   tails [2]                      heads [2]                                      vectors                           distances      
---------------- -------------------------------------------- ---------------------------------------------- ---------------------
-200.0 .. -200.0   -199.98894508679746 .. -199.99979940906726   (0.01105491320254108+0.0002005909327414679j)  0.011056732909771095
-175.0 .. -200.0    -174.98580017725635 .. -199.9983989550576  (0.014199822743647922+0.0016010449423899328j)  0.014289797439382168
-150.0 .. -200.0     -149.9826220098719 .. -199.9948555698346   (0.017377990128098278+0.005144430165386835j)  0.018123457247965224
-125.0 .. -200.0    -124.9804848579651 .. -199.98984411247562   (0.019515142034900748+0.010155887524377193j)  0.021999609543129406
-100.0 .. -200.0    -99.98115009515332 .. -199.98377371505575    (0.018849904846678138+0.01622628494424091j)  0.024871896506308465
 -75.0 .. -200.0     -74.98617991171511 .. -199.9778397819675    (0.013820088284892056+0.02216021803250226j)  0.026116471879835703
 -50.0 .. -200.0    -49.995669118604184 .. -199.9737486834166   (0.0043308813958194345+0.02625131658338817j)  0.026606167631320482
 -25.0 .. -200.0   -25.008083574408424 .. -199.97303278097837    (-0.008083574408424929+0.0269672190216266j)  0.028152709940197976
   0.0 .. -200.0  -0.020846977854617255 .. -199.9764336610456  (-0.020846977854617255+0.023566338954408322j)   0.03146376991692136
  25.0 .. -200.0     24.968928935884133 .. -199.9835582252587   (-0.031071064115867825+0.01644177474131643j)   0.03515313616075471
  50.0 .. -200.0     49.96361594995354 .. -199.99286226449442     (-0.0363840500464572+0.00713773550558007j)   0.03707757227665696
  75.0 .. -200.0     74.96406028598429 .. -200.00211683891587  (-0.03593971401571694-0.0021168389158774947j)  0.036002000646176514
 100.0 .. -200.0      99.96929089048109 .. -200.0092588391614    (-0.03070910951890607-0.00925883916139729j)   0.03207453055090271
 125.0 .. -200.0    124.97697885388547 .. -200.01318830488344   (-0.02302114611452402-0.013188304883432832j)   0.02653119963598787
 150.0 .. -200.0    149.98441883332313 .. -200.01411870141098   (-0.01558116667685537-0.014118701410976986j)  0.021026423484374886
 175.0 .. -200.0    174.99008531063896 .. -200.01315042069206  (-0.009914689361028212-0.013150420692066699j)   0.01646920245500741
 200.0 .. -200.0     199.9938956000957 .. -200.01235656255233  (-0.006104399904290153-0.012356562552330752j)   0.01378217458535337
-200.0 .. -175.0    -199.9879452755082 .. -175.00294431860837   (0.01205472449180349-0.0029443186083653733j)  0.012409085165347746
-175.0 .. -175.0    -174.98374019779763 .. -175.0015604935204  (0.016259802202370534-0.0015604935203886658j)  0.016334512777777876
-150.0 .. -175.0   -149.97889890690814 .. -174.99751322948023  (0.021101093091854033+0.0024867705197604215j)  0.021247121152971275
-125.0 .. -175.0     -124.974709741938 .. -174.99058006983492   (0.025290258062006257+0.009419930165087263j)  0.026987631188342437
-100.0 .. -175.0    -99.97381304890273 .. -174.98092618818075   (0.026186951097270407+0.019073811819245258j)   0.03239701691648186
 -75.0 .. -175.0    -74.97874565504182 .. -174.97058027024207   (0.021254344958186688+0.029419729757931612j)   0.03629418243508624
 -50.0 .. -175.0    -49.98975070718047 .. -174.96279685206994   (0.010249292819527581+0.037203147930046664j)   0.03858914639125041
 -25.0 .. -175.0    -25.00480635859456 .. -174.96044385135315  (-0.004806358594560495+0.039556148646844945j)   0.03984708243662011
   0.0 .. -175.0 -0.020633221863724363 .. -174.96493991619187   (-0.020633221863724363+0.03506008380812977j)   0.04068094543039476
  25.0 .. -175.0    24.966414597888374 .. -174.97578968916275   (-0.03358540211162743+0.024210310837236404j)  0.041401912828217424
  50.0 .. -175.0     49.959454435349706 .. -174.9904279395445  (-0.040545564650292854+0.009572060455504627j)   0.04166013867205572
  75.0 .. -175.0     74.95965651276023 .. -175.00495430917965    (-0.04034348723976727-0.00495430917965306j)   0.04064655141722185
 100.0 .. -175.0     99.96590476359482 .. -175.01571812311198   (-0.03409523640517173-0.015718123111993748j)   0.03754390149795756
 125.0 .. -175.0    124.97532319764039 .. -175.02075227630445   (-0.024676802359613517-0.02075227630445818j)   0.03224285264228344
             ...                                          ...                                            ...                   ...
 -150.0 .. 175.0     -150.0049421229477 .. 174.98799271269746  (-0.004942122947716527-0.012007287302543662j)  0.012984588079572357
 -125.0 .. 175.0    -125.01165724531509 .. 174.98556953178596  (-0.011657245315088518-0.014430468214052469j)  0.018550735328092302
 -100.0 .. 175.0     -100.02145970959727 .. 174.9878604452871   (-0.02145970959726709-0.012139554712886597j)  0.024655383278833945
  -75.0 .. 175.0     -75.03100194783012 .. 174.99729997661487 (-0.031001947830119836-0.0027000233851297017j)  0.031119301013064534
  -50.0 .. 175.0     -50.03521901423264 .. 175.01276263555454   (-0.03521901423263613+0.012762635554549599j)    0.0374601632379903
  -25.0 .. 175.0    -25.030105998231463 .. 175.02863028090394    (-0.030105998231462767+0.0286302809039526j)  0.041545927768580064
    0.0 .. 175.0   -0.01654782540540443 .. 175.03729712658856    (-0.01654782540540443+0.03729712658856176j)   0.04080326184768748
   25.0 .. 175.0      24.999178066603662 .. 175.0345433174841  (-0.0008219333963364085+0.03454331748408093j)   0.03455309475740233
   50.0 .. 175.0       50.01023452372228 .. 175.0226184147507    (0.010234523722281397+0.02261841475070735j)  0.024826158818008006
   75.0 .. 175.0      75.01393760660949 .. 175.00782263358977   (0.013937606609490227+0.007822633589769222j)  0.015982818095714266
  100.0 .. 175.0      100.01180866320985 .. 174.9959317072249   (0.011808663209855245-0.004068292775086222j)  0.012489817168702172
  125.0 .. 175.0     125.00700883175801 .. 174.98973508295407    (0.00700883175801913-0.010264917045918323j)  0.012429490921666987
  150.0 .. 175.0      150.0025970882903 .. 174.98883610745187   (0.002597088290295365-0.011163892548134175j)  0.011461996528261343
  175.0 .. 175.0       175.000042333468 .. 174.99088019134044   (4.23334680051974e-05-0.009119808659564818j)  0.009119906913427723
  200.0 .. 175.0        199.9991173296012 .. 174.992285020398 (-0.0008826703987964354-0.007714979602026422j)  0.007765308576778854
 -200.0 .. 200.0     -200.0012911077879 .. 199.99491182203025 (-0.0012911077878836573-0.005088177969762266j)  0.005249429909228991
 -175.0 .. 200.0    -175.00261109642628 .. 199.99399963198155  (-0.002611096426291523-0.006000368018446214j) 0.0065438704834512515
 -150.0 .. 200.0    -150.00577724819712 .. 199.99244914356572    (-0.005777248197126564-0.0075508564342818j)  0.009507472304579014
 -125.0 .. 200.0    -125.01152395816281 .. 199.99226112809416  (-0.011523958162815248-0.007738871905844522j)  0.013881345399974234
 -100.0 .. 200.0    -100.01916044081354 .. 199.99504555566907  (-0.019160440813542456-0.004954444330937533j)  0.019790629368406216
  -75.0 .. 200.0     -75.02589417892672 .. 200.00165352315997 (-0.025894178926713377+0.0016535231599618117j)   0.02594691968479452
  -50.0 .. 200.0     -50.02786753390372 .. 200.01101368513176  (-0.027867533903725483+0.011013685131769452j)   0.02996499134084722
  -25.0 .. 200.0    -25.022396278081153 .. 200.01995647952933  (-0.022396278081153083+0.019956479529326998j)   0.02999757235332195
    0.0 .. 200.0  -0.010519931154474279 .. 200.02464796474473  (-0.010519931154474279+0.024647964744735712j)  0.026799087998523628
   25.0 .. 200.0        25.0029020456065 .. 200.0230070246799  (0.0029020456064990114+0.023007024679912932j)   0.02318933059241519
   50.0 .. 200.0      50.01255265445386 .. 200.01605384478864   (0.012552654453861722+0.016053844788657852j)  0.020378789619022307
   75.0 .. 200.0       75.0160311855306 .. 200.00698181606953  (0.016031185530598013+0.0069818160695139415j)  0.017485555900370403
  100.0 .. 200.0      100.01423428949437 .. 199.9990830951397  (0.014234289494372283-0.0009169048602921809j)  0.014263790237255474
  125.0 .. 200.0     125.00972840970101 .. 199.99426064519042   (0.009728409701009931-0.005739354809582681j)  0.011295226821139271
  150.0 .. 200.0      150.0051831650217 .. 199.99265920659016   (0.005183165021700999-0.007340793409840873j)  0.008986236560882866
  175.0 .. 200.0      175.00208221142444 .. 199.9932179433466   (0.002082211424423327-0.006782056653415795j)  0.007094497647200997
  200.0 .. 200.0        200.0005076610094 .. 199.993859570813  (0.0005076610094029536-0.006140429187006049j)   0.00616137892854382
Length = 289 rows
```

```python
>>> pole_info = Bz.pole()
>>> print(pole_info)
     type              0.0 s         
-------------- ----------------------
min coordinate         (75.0, -100.0)
max coordinate          (-25.0, 50.0)
        vector             (-100-50j)
      distance     111.80339887498948
         angle 153.43494882292202 deg
         ratio     0.9979379997057799
```

## Build a field map plot

```python
>>> import matplotlib.pyplot as plt
>>> import matplotlib.patches as mpatches
>>> fig, ax = plt.subplots(figsize=(15, 12))
>>> ctr = ax.contourf(Bz.X, Bz.Y, Bz, 200, cmap='rainbow')
>>> cbar = fig.colorbar(ctr)
```

## Add current and the pole arrows on the field map plot

```python
>>> for arrow in arrows_info:
>>>     tail = arrow['tails']
>>>     head = arrow['heads']
>>>     dipole =  mpatches.FancyArrowPatch(tail, head, mutation_scale=10)
>>>     ax.add_patch(dipole)
>>> pole = mpatches.FancyArrowPatch(pole_info[0][1], pole_info[1][1], mutation_scale=10)
>>> ax.add_patch(pole)
>>> ax.set_xlim(-200,200)
>>> ax.set_ylim(-200,200)
>>> plt.show()
```

[(plot)](https://github.com/pjjung/mcgpy/blob/gh-pages/imgs/visualization-arrowdmap-example.png)

![visualization-arrowdmap-example](../imgs/visualization-arrowdmap-example.png)

## References

* [`mcgpy.timeseriesarray.TimeSeriesArray`](https://pjjung.github.io/mcgpy/Classes/TimeSeriesArray.html)
* [`mcgpy.numeric.FieldMap`](https://pjjung.github.io/mcgpy/Classes/FieldMap.html)
